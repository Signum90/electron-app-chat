<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <main>
    <div class="row">
      <!-- COLUMNA IZQUIERDA -->
      <div class="col-4" id="left">
        <button onclick="onClick()">Click</button>
        <!-- LISTADO TARJETAS -->
        <ul class="contact list-unstyled mt-2 mb-0">
          
        </ul>
      </div>
      <!-- COLUMNA DERECHA -->
      <div class="col-8 chats" id="right" >
        
        <!-- INPUT PARA LOS MENSAJKES -->
        <form action="" class="form-message">
          <div class="row">
            <div class="col">
              <textarea name="" id="" class="form-control rounded-pill"></textarea>
            </div>

            <div class="col-auto">
              <button class="btn btn-primary rounded-circle send-button">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" />
                </svg>


              </button>
            </div>
          </div>
        </form>
      </div>
    </div>  
  </main>
  <script>
    // IMPORTAR 
    const { ipcRenderer } = require('electron');
    // ESCUCHAR MENSAJES DEL PROCESO PRINCIPAL:
    // Escuchar mensaje al proceso principal, main.js
    ipcRenderer.on('data-from-server', (event, args) => {
      // Los valores enviados por el servidor llegan en los args
      console.log('Mensaje del servidor', args);
    });
    // ENVIAR MENSAJES AL PROCESO PRINCIPAL
    ipcRenderer.send('data-from-web', 'Hola Server');
    // Enviar desde un evento click en el Front
    const onClick = () => {
      ipcRenderer.send('data-from-web-click', {dato: 'el coco'})
    }

    // CREAR CONTACTOS =======================>
    const createContacts = (contacts) => {
      let list = '';
      contacts.forEach(contact => {
        list += `
          <li class="p-2 card mt-2">
            <div class="card-body">
              <div class="d-flex">
                <div>
                  <img class="rounded-pill me-3" width="60" src="${ contact.image }">
                </div>
                <div>
                  <p class="fw-bold mb-0 text-light">${ contact.name }</p>
                  <p class="small text-muted">${ contact.last_chat[0].message }</p>
                </div>
                <div>
                  <p class="small text-muted">${ contact.last_chat[0].date }</p>
                  <span class="badge bg-danger rounded-pill float-end">${ contact.last_chat.length }</span>
                </div>
              </div>
            </div>
          </li>
        `
      });
      document.querySelector('.contact').innerHTML = list;
    }

    // CREAR CHATS ===========================>
    const createChats = (chats) => {  
      let list = '';
      chats.forEach(chat => {
        list += `
          <div class="d-flex chat">
            <!-- DISEÑO CAJA IMAGEN -->
            <div class="w-25 d-flex align-items-end justify-content-end">
              <img class="rounded-pill me-3 avatar" width="60" src="${ chat.image }">
            </div>
            <!-- DISEÑO CAJA CHAT -->
            <div class="w-75">
              <div class="card">
                <div class="card-body">${ chat.last_chat.message }</div>
              </div>
              <p class="small text-light">${ chat.last_chat.date }</p>
            </div>
          </div> 
        `
      });
      document.querySelector('.chats').innerHTML = list;
    }
    
    // RECIBIR DATOS =========================>
    ipcRenderer.on('contacts', (event, contacts) => {
      createContacts(contacts);
    });

    ipcRenderer.on('chats', (event, chats) => {
      createChats(chats);
    })
  </script>
</body>
</html>